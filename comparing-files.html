<!doctype html>
<html itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <link rel="alternate" type="application/atom+xml" title="Morning Coffee" href="/feed.xml" />

    <link rel="shortcut icon" href="favicon.svg">

    <meta name="viewport" content="width=device-width, initial-scale=1">

      <title>Comparing files on different servers &mdash; by Igor Šarčević</title>

    <!-- Place this data between the <head> tags of your website -->
      <meta name="description" content="Let’s say you have two servers named gandalf and charmander, and a configuration
file config.xml that should be present on each server. Due to some human error
the files got different and your servers started to act weird. It would be nice
to compare them and find out what part of them is different.

" />

      <!-- Schema.org markup for Google+ -->
      <meta itemprop="name" content="Comparing files on different servers">
      <meta itemprop="description" content="Let’s say you have two servers named gandalf and charmander, and a configuration
file config.xml that should be present on each server. Due to some human error
the files got different and your servers started to act weird. It would be nice
to compare them and find out what part of them is different.

">
      <meta itemprop="image" content="http://morningcoffee.io/images/comparing-files.png">

      <!-- Twitter Card data -->
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:site" content="@igor_sarcevic">
      <meta name="twitter:title" content="Comparing files on different servers">
      <meta name="twitter:description" content="Let’s say you have two servers named gandalf and charmander, and a configuration
file config.xml that should be present on each server. Due to some human error
the files got different and your servers started to act weird. It would be nice
to compare them and find out what part of them is different.

">
      <meta name="twitter:creator" content="@igor_sarcevic">
      <!-- Twitter summary card with large image must be at least 280x150px -->
      <meta name="twitter:image:src" content="http://morningcoffee.io/images/comparing-files.png">

      <!-- Open Graph data -->
      <meta property="og:title" content="Comparing files on different servers" />
      <meta property="og:type" content="article" />
      <meta property="og:url" content="http://" />
      <meta property="og:image" content="http://morningcoffee.io/images/comparing-files.png" />
      <meta property="og:description" content="Let’s say you have two servers named gandalf and charmander, and a configuration
file config.xml that should be present on each server. Due to some human error
the files got different and your servers started to act weird. It would be nice
to compare them and find out what part of them is different.

" />
      <meta property="article:published_time" content="2015-05-27 00:00:00 UTC" />

    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Raleway:900&display=swap" rel="stylesheet">
    <link href="/stylesheets/style.css" rel="stylesheet" />
  </head>
  <body>

    <div id="main" role="main">
      <div style="font-size: 16px; color: rgba(0, 0, 0, 0.8); padding: 10px; font-weight: 400; text-align: center">
  You are reading <a href="/">Morning Coffee</a>, a blog about software engineering written by <a href="/about-me.html">Igor Šarčević</a>. <br> Have a nice day!
</div>


        <article class="article">
    <div class="header">
      <h1>Comparing files on different servers</h1>

      <div style="display: flex; items-align: center; font-size: 18px; color: #444; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding-top: 10px; padding-bottom: 10px;">
        <img src="https://pbs.twimg.com/profile_images/1645826320729767941/xmJQNFJz_400x400.jpg" alt="Igor Sarcevic" style="height: 30px; width: 30px; border-radius: 50%; margin-right: 8px;">
        Igor wrote this in May 2015
      </div>
    </div>

    <div class="content">
      <p>Let&rsquo;s say you have two servers named <code>gandalf</code> and <code>charmander</code>, and a configuration
file <code>config.xml</code> that should be present on each server. Due to some human error
the files got different and your servers started to act weird. It would be nice
to compare them and find out what part of them is different.</p>

<p></p>

<p>Luckily, you have <code>ssh</code> access to both servers. A simple solution is to <code>scp</code> both
file to a local temp file and compare them with <code>diff</code>.</p>
<div class="highlight"><pre class="highlight shell"><code>scp gandalf:~/config.xml /tmp/gandalf_config.xml
scp charmander:~/config.xml /tmp/charmander_config.xml

diff /tmp/gandalf_config.xml /tmp/charmander_config.xml
</code></pre></div>
<p>The above works like a charm, but can we do it in fewer steps? Well, if the files are
not gigantic we can use the <code>&lt;( command )</code> pattern to compare them without temp files.</p>
<div class="highlight"><pre class="highlight shell"><code>diff &lt;<span class="o">(</span>ssh gandalf <span class="s2">"cat ~/config.xml"</span><span class="o">)</span> &lt;<span class="o">(</span>ssh charmander <span class="s2">"cat ~/config.xml"</span><span class="o">)</span>
</code></pre></div>
<p>This technique is called <a href="http://tldp.org/LDP/abs/html/process-sub.html">Process substitution</a>
and can have even more powerful use cases.</p>

<h2>Scaling the issue</h2>

<p>But what if we have more than two servers, lets say a hundred, and we want to check whether
we have the same configuration file on every one of them?</p>

<p>A good server naming scheme combined with a <code>for</code> loop can help us a lot. A good naming
scheme can be to replace special names like <code>gandalf</code> and <code>charizard</code> with a baring yet
wastly more handy form like the following:</p>
<div class="highlight"><pre class="highlight plaintext"><code>s1, s2, ... s100
</code></pre></div>
<p>First, let&rsquo;s save a local copy of a good configuration file:</p>
<div class="highlight"><pre class="highlight shell"><code>scp s1:~/config.xml /tmp/good
</code></pre></div>
<p>To compare this file with a remote file we can use the above scheme:</p>
<div class="highlight"><pre class="highlight shell"><code>diff /tmp/good &lt;<span class="o">(</span>ssh s2 <span class="s2">"cat ~/config.xml"</span><span class="o">)</span>
</code></pre></div>
<p>and loop through all the servers with a nifty <code>for</code> loop:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>2..100<span class="o">}</span><span class="p">;</span> <span class="o">{</span> diff /tmp/good &lt;<span class="o">(</span>ssh <span class="s2">"s</span><span class="nv">$i</span><span class="s2">"</span> <span class="s2">"cat ~/config.xml"</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>
    </div>


  </article>


      <div class="footer">
  <div class="content">
    <p>
      <strong>❈</strong><br>
      <br>

      Follow me on <a href="https://twitter.com/igor_sarcevic">Twitter</a> and <a href="https://rs.linkedin.com/in/igorsarcevic">LinkedIn</a>.<br>
      Copyright ©2014-2024 Igor Šarčević. All rights reserved.</br>
      <br>
      Enjoy the rest of your day!
    </p>
  </div>
<div>

    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
           })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57223799-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script>
      /**
      * Function that tracks a click on an outbound link in Analytics.
      * This function takes a valid URL string as an argument, and uses that URL string
      * as the event label. Setting the transport method to 'beacon' lets the hit be sent
      * using 'navigator.sendBeacon' in browser that support it.
      */
      var trackOutboundLink = function(url) {
        ga('send', 'event', 'outbound', 'click', url, {
          'transport': 'beacon',
          'hitCallback': function(){document.location = url;}
        });
      }
    </script>

  </body>
</html>
